version: 0.2

phases:
  pre_build:
    commands:
      - echo List S3 Bucket Objects
      - aws --version
      - aws s3 ls s3://$S3Bucket/$StackName-CodeP/SourceCode/
      - filename=$(aws s3 ls s3://$S3Bucket/$StackName-CodeP/SourceCode/ | awk '{print $4}')
      - echo $filename
  build:
    commands:
      - echo Build started on `date`
      - echo Unzip listed object from previous phase
      - aws s3 cp s3://$S3Bucket/$StackName-CodeP/SourceCode/$filename  ./
      - echo Remove zip file
      - aws s3 rm s3://$S3Bucket/$StackName-CodeP/SourceCode/$filename --recursive
      - ls -lart
      - echo upload extracted files to zipped folder in the same S3 Bucket
      - for i in `ls | grep yaml`;do aws s3 cp $i s3://$S3Bucket/unzipped/;done
  post_build:
    commands:
      - echo Build completed on `date`

